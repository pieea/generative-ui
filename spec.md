# 개요
https://research.google/blog/generative-ui-a-rich-custom-visual-interactive-user-experience-for-any-prompt/ 와 유사하게 구현
검색어와 검색 결과의 특성을 분석하여 가장 적합한 UI를 구성해 주는 것을 1차 목표로 한다.
사용자의 요구사항에 따라 UI를 재구성 할 수 있는 기능을 제공한다.

# 상세 구현
- 검색어를 입력받아 검색 엔진에 날린다(이 부분은 향후 변경 가능). LLM이 검색어 rewrite를 한다.
- 검색어를 확장할 필요가 있을 경우 각각에 대해서 호출하고 합친 결과를 리턴한다(e.g. 이병헌 대종상 -> 이병헌(인물), 이병헌 대종상(뉴스)). 해당 부분은 검색어 rewrite에서 수행한다.
- 검색어 rewrite 영역은 디버그 용으로 노출해줘.
- 검색어와 검색결과에 따라서 내부적으로 보유하고 있는 UI 템플릿 중 적합한 형태를 판단한다. 필요에 따라서는 메인 / 컨트롤러를 합치거나 둘 이상의 메인 템플릿을 조합한다.
- 사용자가 추가적인 피드백을 요구하는 경우(e.g. 날짜로 필터링 하고 싶어, 화면을 크게 보고 싶어) 해당 요구사항을 반영한 형태로 UI를 재구성한다.
- 요청 패턴에 따른 템플릿 결과는 캐싱을 한다

# 검색엔진 활용
- URL: https://search.daum.net/search?w=tot&nil_mtopsearch=btn&DA=YZR&q={query}
- class="g_comp" 항목을 필터링 해서 결과로 사용
- 관련 검색어를 제외하고 1~2번째로 나오는 결과가 해당 키워드에 대한 주요 검색 결과
- 주요 검색 결과를 사용해서 검색어의 의도를 파악하고 템플릿에 대해 결정한다.

# 기술 스펙
- Next.js 15 활용

# 세부 정책

## 1. 쿼리 리라이트 (Query Rewrite)

### 이중 쿼리 확장 규칙
- 복합 의도 검색어는 여러 쿼리로 확장하여 병렬 검색 후 결과 병합
- **원본 쿼리는 반드시 포함**

### 확장 패턴 예시
| 원본 쿼리 | 확장 결과 |
|-----------|-----------|
| 이병헌 대종상 | "이병헌"(people) + "이병헌 대종상"(news) |
| 손흥민 토트넘 | "손흥민"(people) + "손흥민 토트넘"(news) |
| 피렌체 예지원 | "예지원"(people) + "피렌체 예지원"(news) |
| 명세빈 생활고 | "명세빈"(people) + "명세빈 생활고"(news) |
| 아이폰 16 출시 | "아이폰 16"(products) + "아이폰 16 출시"(news) |

### 인물 이름 감지 규칙
- 한글 2~4글자 이름 패턴 (예: 예지원, 손흥민, 이병헌)
- 장소/지역명 + 인물 조합 시 인물 쿼리 분리
- 인물 + 이슈/사건 조합 시 인물 쿼리 분리

## 2. 검색엔진 파싱 (다음 검색)

### 컴포넌트 타입 감지
`disp-attr` 속성 기반으로 컴포넌트 타입 판별:
| disp-attr | 타입 | 설명 |
|-----------|------|------|
| PRF | people | 인물 프로필 |
| DNS | news | 뉴스 |
| SNY | products | 쇼핑 |
| IIM | images | 이미지 |
| VOI | videos | 동영상 |
| TWA, TWD | web | 통합웹/웹문서 |

### 뉴스 파싱 셀렉터
- 뉴스 목록: `.c-list-basic > li[data-docid]`
- 뉴스 제목: `.item-title .tit-g`, `.tit-g.clamp-g`
- 뉴스 내용: `.conts-desc`, `.item-contents p`
- 언론사: `.c-tit-doc .tit_item .txt_info`
- 시간: `.gem-subinfo .txt_info`
- 이미지: `img[data-original-src]` 속성 우선

### 인물 정보 추출 (PRF 섹션)
- PRF 섹션은 JavaScript로 동적 렌더링되어 SSR로 직접 파싱 불가
- LLM을 활용하여 뉴스/웹 컨텐츠에서 인물 정보 추출
- 인물 검색 시 4개 컴포넌트까지 분석 (일반 검색은 2개)

## 3. LLM 데이터 추출

### 인물 검색 특화 프롬프트
인물 검색으로 판단되면:
1. 첫 번째 항목으로 인물 프로필 카드 생성
2. category: "인물"
3. metadata에 occupation, organization 등 포함
4. 뉴스/기사에서 인물 관련 최신 정보 추출

### 인물 검색 판단 조건
- `disp-attr="PRF"` 컴포넌트 존재
- 쿼리 리라이트에서 `people` 의도 감지
- 한글 이름 패턴 (`/[가-힣]{2,4}$/`)

## 4. 템플릿 선택 로직

### 메타데이터 기반 판단 (우선순위 높음)
| 조건 | 템플릿 | resultType |
|------|--------|------------|
| condition 존재 | weather | weather |
| price + rating 존재 | shopping | products |
| address 존재 | map | locations |
| occupation/birthDate 존재 | 아래 참조 | people |
| body 존재 | article | news |

### 인물 정보 템플릿 분기
| 조건 | 템플릿 |
|------|--------|
| 인물(1건) + 뉴스(N건) | hero (복합 레이아웃) |
| 인물만 1건 | profile |
| 인물 여러 명 | grid |

### 기본값
| 조건 | 템플릿 |
|------|--------|
| 이미지 포함 + 6개 이상 | gallery |
| 3개 이상 | hero |
| 그 외 | card |

## 5. 디버그 UI

### 표시 정보
- 쿼리 확장 여부: `[이중쿼리]` 또는 `[단일쿼리]`
- 확장된 쿼리 목록: `"쿼리"(의도)` 형식
- 컴포넌트 분석 결과: `[타입]제목(건수)`
- LLM 추출 건수
- 최종 선택 템플릿

### 다음 검색 링크
- 이중 쿼리: 각 쿼리별 다음 검색 링크 제공
- 단일 쿼리: 원본 쿼리 다음 검색 링크 제공
- 새 탭에서 열림 (`target="_blank"`)

## 6. 결과 병합 정책

### 중복 제거
- 제목 기준 중복 제거 (소문자 + trim 후 비교)
- LLM 추출 아이템 우선 유지

### 아이템 태깅
- `querySource`: 어떤 쿼리에서 추출되었는지
- `queryIntent`: 해당 쿼리의 의도
- `extractedByLLM`: LLM 추출 여부
- `sourceIntent`: 원본 컴포넌트 타입